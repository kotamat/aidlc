# ドメイン理解サマリ

## コンシューマ体験
- 主要目的: レストラン探索、注文、決済、トラッキング、再注文、変更申請をシームレスに行うことで顧客満足度を高める。
- 主なアクター: 一般消費者、決済サービス、配送トラッキングシステム。
- キーワークフロー: フィルタリングによる店舗検索、支払い方法の登録と選択、リアルタイム配達状況確認、履歴からの再注文、注文変更やキャンセルの申請と進捗確認。

## 配達員モビリティ
- 主要目的: 配達員が効率よく案件を選び、迷わず配達し、実績と報酬を確実に管理できるようにする。
- 主なアクター: 配達員、ナビゲーションサービス、報酬管理システム、顧客。
- キーワークフロー: 希望条件に合う案件提示と受諾、リアルタイムナビゲーション、配達証跡アップロード、報酬ダッシュボードでの確認とエクスポート。

## レストランオペレーション
- 主要目的: レストランが自律的に店舗情報とメニューを管理し、注文を円滑に処理し、経営判断に必要な分析を得る。
- 主なアクター: レストランパートナー、店舗スタッフ、調理スタッフ、分析レポート利用者。
- キーワークフロー: 営業時間・配達エリアの設定、メニュー管理、注文・変更依頼のリアルタイム処理、売上と注文傾向のレポート確認。

## プラットフォーム運用
- 主要目的: サポート問い合わせ処理、リスク対処、需要供給バランス監視を通じてプラットフォームの安定運用を実現する。
- 主なアクター: プラットフォーム運用担当者、サポートエージェント、リスク対処チーム、モニタリングシステム。
- キーワークフロー: 問い合わせチケット管理、リスク検知と対処ワークフロー実行、都市別稼働指標の監視とアラート対応。

## 統合契約
- 主要目的: 各ユニットが独立したサービスとして連携するための API 契約を明確化する。
- 主なアクター: API ゲートウェイ、各ユニットのサービス。
- キーワークフロー: コンシューマ体験、レストラン運用、配達員モビリティ、プラットフォーム運用に関わる API エンドポイントのリクエスト・レスポンス契約と、共通 ID による連携。

## モデリング方針
- 境界づけられたコンテキスト: 各ユニットは独立したコンテキストとして扱い、アグリゲートやエンティティはユニット内で完結させる。
- 連携方式: `integration_contract` で定義された API と非同期イベントを前提に、ID ベースでルーズカップリングを維持する。
- 詳細レベル: 各ユニットごとにアグリゲート構造、主要エンティティ、値オブジェクト、リポジトリ契約、ドメインサービス、ポリシー、主要ドメインイベントを網羅的に整理する。
- 用語統一: 共通 ID やステータス名などはユビキタス言語として記録し、後続の整合性確認でユニット横断の用語衝突を回避する。

## 横断整合チェック
- 共通 ID: 注文ID、ユーザーID、店舗ID、配達員IDを全ユニットで共有し、イベントおよび API パラメータに同名で採用する。
- イベント整合: `OrderPlaced`（コンシューマ）→`OrderAcknowledged`（レストラン）→`DeliveryCompleted`（配達員）→`OpsReportGenerated`（プラットフォーム）という時系列を前提にイベント名を整合させる。失敗時は `DeliveryFailed` と `RiskDetected` が連動。
- ステータス語彙: 注文ステータス（`PENDING`, `CONFIRMED`, `PREPARING`, `EN_ROUTE`, `DELIVERED`, `FAILED`）と配達ステータス（`ACCEPTED`, `PICKED_UP`, `DELIVERING`, `COMPLETED`）をユニット横断で共有し、`OrderStatusUpdated` イベントで通知する。
- キャンセル／変更: `OrderChangeRequested` と `OrderCancellationRequested` をトリガーに `restaurant_operations` の `OrderChangeResponded` と `OrderRejected` を接続し、結果を `consumer_experience` の `OrderStatusUpdated` に反映する。
- サポート連携: `platform_operations` の `SupportTicket` は各ユニットのイベント（例: `DeliveryFailed`, `OrderRejected`）から生成し、解決結果を `TicketResolved` として該当ユニットへフィードバックする。

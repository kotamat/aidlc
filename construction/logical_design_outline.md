## 論理設計骨子メモ

### Consumer Experience
- 要旨: 消費者向け注文体験を支えるコマンド／クエリアプリケーションとリアルタイム追跡の分離。
- コンポーネント: API ファサード、アプリケーションサービス（注文、カート、アカウント）、イベント購読者、投機的価格計算エンジン、通知ゲートウェイ。
- データフロー: API → アプリケーションサービス → ドメイン → イベント発行／リードモデル更新、外部イベント（配達状況、店舗更新）を購読してレプリカ更新。
- 境界: ショッピングカート、注文、トラッキング。決済実行・配達運行・店舗調理は外部。
- インターフェース整合: `GET /consumer/restaurants` はクエリリードモデル、`POST /consumer/orders` は CheckoutOrchestrator、`PATCH /consumer/orders/{orderId}` は変更ワークフロー、トラッキング系 API は `OrderExperienceTimeline` 投影と連携。

### Restaurant Operations
- 要旨: 店舗ダッシュボード、注文ボード、メニュー管理、分析を分割し、負荷ピークに耐えるイベント駆動パイプラインを構築。
- コンポーネント: 店舗設定サービス、メニュー編集コマンドハンドラ、リアルタイム注文ボード、分析集計ワーカー、アラート通知。
- データフロー: API → コマンドハンドラ → ドメイン → イベント発行、Consumer/Courier からのイベント購読で注文および配達状況同期。
- 境界: 店舗内設定／メニュー／注文調理／分析。消費者 UI、決済処理、配達ルーティングは外部。
- インターフェース整合: `PUT /restaurants/{restaurantId}/settings` は RestaurantAccount 更新、メニュー API は MenuCatalog、注文照会／ステータス更新 API は OrderBoard、分析 API は RevenueLedger 投影。

### Courier Mobility
- 要旨: 案件配信と稼働トラッキングをリアルタイムストリーム化し、配達証跡と報酬計算を疎結合化。
- コンポーネント: Courier API ファサード、ジョブマッチング、デリバリーアサインメントオーケストレーター、証跡検証、報酬計算＆スケジューラ。
- データフロー: API → コマンドサービス → ドメイン → イベント発行、店舗／消費者／運用からのシグナルを購読しステータス更新・アラート処理。
- 境界: 配達員プロフィール、案件配信、配送中追跡、報酬。注文受付／決済は外部。
- インターフェース整合: `GET /couriers/{courierId}/jobs` は JobOfferStream 投影、受諾 API は DeliveryAssignment 開始、ルート／証跡 API は RoutePlan・ProofPackage、報酬 API は PayoutStatement 集計。

### Platform Operations
- 要旨: サポートチケット、リスクケース、都市運用指標を共通ワークフロー基盤上に集約。
- コンポーネント: チケットルーティングサービス、リスクスコアリングエンジン、都市インジケータ集計、ワークフローエンジン、通知／レポート。
- データフロー: API → コントローラ → ワークフロー → ドメイン、各ユニット発行イベントを取り込みチケット生成・リスク検知、意思決定後に結果イベントを返送。
- 境界: 運用統制、サポート、リスク、都市監視。注文・配達実行・店舗運営詳細は外部。
- インターフェース整合: `GET /operations/tickets` などチケット API は SupportTicket 投影、`PATCH` はワークフロー連動、リスク API は RiskCase、都市指標 API は CityOperationsBoard。

### Integration Contract
- 要旨: API/イベント契約のライフサイクル管理を中心とし、変更影響を統制する契約レジストリ。
- コンポーネント: 契約レジストリ API、契約バリデーションパイプライン、互換性マトリクス、変更申請ワークフロー、通知サービス。
- データフロー: 契約登録／更新リクエスト → バリデーション → ドメイン → 契約ストア＆通知。各ユニットの契約イベントを発行。
- 境界: 契約メタデータ管理、変更フロー。コンテキスト固有ロジックは扱わない。
- インターフェース整合: 各ユニットの契約差分を `integration_contract` が集約し、バージョン通知イベントで依存サービスへ周知する。
